{"version":3,"sources":["../src/module.js"],"names":["MetricsPanelCtrl","_","angular","kbn","config","TimeSeries","AnnunciatorPanelCtrl","$scope","$injector","panelDefaults","panel","elem","ctrl","defaults","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","err","console","log","seriesList","render","valueNameOptions","fontSizes","fontSizes0","concat","valueDisplayOptions","unitFormats","getUnitFormats","addEditorTab","subItem","format","value","valueRegion","UpperLimit","DisplayOption","Value","UpperWarning","LowerLimit","LowerWarning","metric","displayAttributes","color","OK","Color","flash","getValueRegion","data","html1","prefix","getTextSpan","prefixFontSize","getValueSpan","valueFontSize","postfix","postfixFontSize","html0","FontSize","html","height","buildLimitsHtml","buildValueHtml","sparkline","show","addSparkline","className","fontSize","text","style","getDisplayAttributesForValue","formatValue","buildHtml","renderingCompleted","dataList","dataPoints","datapoints","length","series","map","seriesHandler","setValues","seriesData","alias","target","flotpairs","getFlotPairs","nullPointMode","isNumber","decimals","scaledDecimals","delta","dec","Math","floor","LN10","magn","pow","norm","size","result","max","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","error","Error","message","JSON","stringify","lastPoint","last","lastValue","isArray","valueName","valueRounded","valueFormatted","isString","escape","stats","roundValue","scopedVars","extend","label","width","setTimeout","plotCanvas","$","plotCss","position","full","bottom","left","dynamicHeightMargin","round","css","options","legend","lines","fill","lineWidth","fillColor","yaxes","xaxis","mode","min","range","from","valueOf","to","grid","hoverable","find","append","plotSeries","lineColor","plot","refresh","scope","attrs","templateUrl"],"mappings":"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","file":"module.js","sourcesContent":["import {\n    MetricsPanelCtrl\n} from 'app/plugins/sdk';\n\nimport \"./css/annunciator-panel.css!\";\n\nimport _ from 'lodash';\n//import moment from 'moment';\nimport angular from 'angular';\nimport kbn from 'app/core/utils/kbn';\nimport config from 'app/core/config';\nimport TimeSeries from 'app/core/time_series2';\n\nclass AnnunciatorPanelCtrl extends MetricsPanelCtrl {\n\n    /** @ngInject */\n    constructor($scope, $injector) {\n        super($scope, $injector);\n\n        var panelDefaults = {\n            \"LowerLimit\": {\n                \"DisplayOption\": \"disabled\",\n                \"Color\": \"rgb(2, 17, 249)\",\n                \"Value\": \"20\",\n                \"FontSize\": \"100%\"\n            },\n            \"LowerWarning\": {\n                \"DisplayOption\": \"disabled\",\n                \"Color\": \"rgb(9, 115, 102)\",\n                \"Value\": \"25\"\n            },\n            \"OK\": {\n                \"Color\": \"rgb(2, 247, 2)\"\n            },\n            \"UpperLimit\": {\n                \"DisplayOption\": \"disabled\",\n                \"Color\": \"rgb(247, 2, 2)\",\n                \"Value\": \"80\"\n            },\n            \"UpperWarning\": {\n                \"DisplayOption\": \"disabled\",\n                \"Color\": \"rgb(247, 90, 7)\",\n                \"Value\": \"75\",\n                \"FontSize\": \"100%\"\n            },\n            \"decimals\": 2,\n            \"format\": \"percent\",\n            \"postfix\": \"POST\",\n            \"postfixFontSize\": \"100%\",\n            \"prefix\": \"PRE\",\n            \"prefixFontSize\": \"100%\",\n            \"sparkline\": {\n                \"fillColor\": \"rgba(19, 193, 91, 0.32)\",\n                \"full\": false,\n                \"lineColor\": \"rgb(145, 200, 16)\",\n                \"show\": true\n            },\n            \"valueFontSize\": \"100%\",\n            \"valueName\": \"current\"\n        };\n\n        var panel = {};\n        //\t\tvar $panelContainer = elem.find('.panel-container');\n        var elem = {}; //this.panel.find('.singlestat-panel');\n        var ctrl = {};\n\n\n        _.defaults(this.panel, this.panelDefaults);\n\n        this.events.on('render', this.onRender.bind(this));\n        this.events.on('data-received', this.onDataReceived.bind(this));\n        this.events.on('data-error', this.onDataError.bind(this));\n        this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    }\n\n    onDataError(err) {\n        console.log(\"Annunciator::onDataError\", err);\n        this.seriesList = [];\n        this.render([]);\n    }\n\n    onInitEditMode() {\n        this.valueNameOptions = ['min', 'max', 'avg', 'current', 'total', 'name', 'first', 'delta', 'diff', 'range'];\n        this.fontSizes = ['20%', '30%', '50%', '70%', '80%', '100%', '110%', '120%', '150%', '170%', '200%'];\n        this.fontSizes0 = [''].concat(this.fontSizes);\n        this.valueDisplayOptions = ['disabled', 'static', 'flash'];\n        this.unitFormats = kbn.getUnitFormats();\n        this.addEditorTab('Options', 'public/plugins/michaeldmoore-annunciator-panel/options.html', 2);\n    }\n\n    setUnitFormat(subItem) {\n        this.panel.format = subItem.value;\n        this.render();\n    }\n\n    getValueRegion(value) {\n        var valueRegion = \"OK\";\n\n        if (this.panel.UpperLimit.DisplayOption != 'disabled') {\n            if (value >= this.panel.UpperLimit.Value)\n                valueRegion = \"UpperLimit\";\n            else if (this.panel.UpperWarning.DisplayOption != 'disabled' && (value >= this.panel.UpperWarning.Value))\n                valueRegion = \"UpperWarning\";\n        }\n\n        if (this.panel.LowerLimit.DisplayOption != 'disabled') {\n            if (value <= this.panel.LowerLimit.Value)\n                valueRegion = \"LowerLimit\";\n            else if (this.panel.LowerWarning.DisplayOption != 'disabled' && (value <= this.panel.LowerWarning.Value))\n                valueRegion = \"LowerWarning\";\n        }\n\n        //console.log (\"this.getValueRegion(\" + value + \")=\" + valueRegion);\n\n        return valueRegion;\n    }\n\n    getDisplayAttributesForValue(value, metric) {\n        var displayAttributes = {};\n        var color = this.panel.OK.Color;\n        var flash = false;\n\n        var valueRegion = this.getValueRegion(this.data.value);\n        switch (valueRegion) {\n            case \"UpperLimit\":\n                color = this.panel.UpperLimit.Color;\n                break;\n\n            case \"UpperWarning\":\n                color = this.panel.UpperWarning.Color;\n                break;\n\n            case \"LowerWarning\":\n                color = this.panel.LowerWarning.Color;\n                break;\n\n            case \"LowerLimit\":\n                color = this.panel.LowerLimit.Color;\n                break;\n        }\n\n        switch (metric) {\n            case \"UpperLimit\":\n                color = this.panel.UpperLimit.Color;\n                break;\n\n                //case \"UpperWarning\": \n                //color = this.panel.UpperWarning.Color; \n                //break;\n\n                //case \"LowerWarning\":\n                //color = this.panel.LowerWarning.Color; \n                //break;\n\n            case \"LowerLimit\":\n                color = this.panel.LowerLimit.Color;\n                break;\n        }\n\n        flash = ((valueRegion == \"UpperLimit\" && this.panel.UpperLimit.DisplayOption == \"flash\" && (metric == \"Value\" || metric == \"UpperLimit\")) ||\n            (valueRegion == \"LowerLimit\" && this.panel.LowerLimit.DisplayOption == \"flash\" && (metric == \"Value\" || metric == \"LowerLimit\")));\n\n        displayAttributes.color = color;\n        displayAttributes.flash = flash;\n\n        //console.log (\"this.getDisplayAttributesForValue(\" + value + \", '\" + metric + \"'), color=\" + color + \", flash=\" + flash);\n        return displayAttributes;\n    }\n\n    buildValueHtml() {\n        var html1 = '';\n\n        html1 += \"<div class='michaeldmoore-annunciator-panel-value-container'>\";\n        if (this.panel.prefix)\n            html1 += this.getTextSpan('michaeldmoore-annunciator-panel-prefix', this.panel.prefixFontSize, '', this.panel.prefix, false);\n\n        html1 += this.getValueSpan('michaeldmoore-annunciator-panel-value', this.panel.valueFontSize, this.data.value, \"Value\");\n\n        if (this.panel.postfix)\n            html1 += this.getTextSpan('michaeldmoore-annunciator-panel-postfix', this.panel.postfixFontSize, '', this.panel.postfix, false);\n\n        html1 += \"</div>\";\n\n        return html1;\n    }\n\n    buildLimitsHtml() {\n        var html0 = '';\n\n        if (this.panel.UpperLimit.DisplayOption != 'disabled' || this.panel.LowerLimit.DisplayOption != 'disabled') {\n            html0 += \"<div class='michaeldmoore-annunciator-panel-limits-container'>\";\n\n            if (this.panel.LowerLimit.DisplayOption != 'disabled')\n                html0 += this.getValueSpan('michaeldmoore-annunciator-panel-lower-limit', this.panel.LowerLimit.FontSize, this.panel.LowerLimit.Value, \"LowerLimit\");\n\n            if (this.panel.UpperLimit.DisplayOption != 'disabled')\n                html0 += this.getValueSpan('michaeldmoore-annunciator-panel-upper-limit', this.panel.UpperLimit.FontSize, this.panel.UpperLimit.Value, \"UpperLimit\");\n\n            html0 += \"</div>\";\n\n            html0 += \"<div style='float:none;'/>\";\n        }\n        return html0;\n    }\n\n    buildHtml() {\n        var html = \"<div class='michaeldmoore-annunciator-panel-container' style='height:\" + this.ctrl.height + \"px;'>\";\n\n        if (this.data != null && this.data.value != null) {\n            html += this.buildLimitsHtml();\n            html += this.buildValueHtml();\n        } else\n            console.log(\"last data point is null...\");\n\n        html += \"</div>\";\n\n        this.elem.html(html);\n\n        if (this.panel.sparkline.show) {\n            this.addSparkline();\n        }\n    }\n\n    getTextSpan(className, fontSize, color, text, flash) {\n        var style = '';\n\n        if (fontSize)\n            style += \"font-size:\" + fontSize + \";\";\n\n        if (color)\n            style += \"color:\" + color + \";\";\n\n        if (style)\n            style = ' style=\"' + style + '\"';\n\n        if (flash)\n            className += \" michaeldmoore-annunciator-flash\";\n\n        return '<span class=\"' + className + '\"' + style + '>' + text + '</span>';\n    }\n\n    getValueSpan(className, fontSize, value, metric) {\n        var displayAttributes = this.getDisplayAttributesForValue(value, metric);\n        return this.getTextSpan(className, fontSize, displayAttributes.color, this.formatValue(value), displayAttributes.flash);\n    }\n\n\n    onRender() {\n        this.buildHtml();\n        this.ctrl.renderingCompleted();\n    }\n\n\n    onDataReceived(dataList) {\n        //console.log(\"Annunciator::onDataReceived()\");\n        var data = {};\n        var dataPoints = dataList[0].datapoints;\n        if (dataPoints.length < 2) {\n            console.log(\"No data\", dataPoints);\n        } else {\n            this.series = dataList.map(this.seriesHandler.bind(this));\n            this.setValues(data);\n            //this.value = dataPoints[0][0];\n        }\n        this.data = data;\n        this.render();\n    }\n\n    seriesHandler(seriesData) {\n        var series = new TimeSeries({\n            datapoints: seriesData.datapoints,\n            alias: seriesData.target,\n        });\n\n        series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\n        return series;\n    }\n\n    getDecimalsForValue(value) {\n        if (_.isNumber(this.panel.decimals)) {\n            return {\n                decimals: this.panel.decimals,\n                scaledDecimals: null\n            };\n        }\n\n        var delta = value / 2;\n        var dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n        var magn = Math.pow(10, -dec),\n            norm = delta / magn, // norm is between 1.0 and 10.0\n            size;\n\n        if (norm < 1.5) {\n            size = 1;\n        } else if (norm < 3) {\n            size = 2;\n            // special case for 2.5, requires an extra decimal\n            if (norm > 2.25) {\n                size = 2.5;\n                ++dec;\n            }\n        } else if (norm < 7.5) {\n            size = 5;\n        } else {\n            size = 10;\n        }\n\n        size *= magn;\n\n        // reduce starting decimals if not needed\n        if (Math.floor(value) === value) {\n            dec = 0;\n        }\n\n        var result = {};\n        result.decimals = Math.max(0, dec);\n        result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n\n        return result;\n    }\n\n    formatValue(value) {\n        var decimalInfo = this.getDecimalsForValue(value);\n        var formatFunc = kbn.valueFormats[this.panel.format];\n        return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n    }\n\n    setValues(data) {\n        //console.log(\"Annunciator::setValues()\");\n        data.flotpairs = [];\n\n        if (this.series.length > 1) {\n            var error = new Error();\n            error.message = 'Multiple Series Error';\n            error.data = 'Metric query returns ' + this.series.length +\n                ' series. Single Stat Panel expects a single series.\\n\\nResponse:\\n' + JSON.stringify(this.series);\n            throw error;\n        }\n\n        if (this.series && this.series.length > 0) {\n            var lastPoint = _.last(this.series[0].datapoints);\n            var lastValue = _.isArray(lastPoint) ? lastPoint[0] : null;\n\n            if (this.panel.valueName === 'name') {\n                data.value = 0;\n                data.valueRounded = 0;\n                data.valueFormatted = this.series[0].alias;\n            } else if (_.isString(lastValue)) {\n                data.value = 0;\n                data.valueFormatted = _.escape(lastValue);\n                data.valueRounded = 0;\n            } else {\n                data.value = this.series[0].stats[this.panel.valueName];\n                data.flotpairs = this.series[0].flotpairs;\n\n                if (data == null || data.value == null) {\n                    data.value = 0.0;\n                }\n\n                var decimalInfo = this.getDecimalsForValue(data.value);\n                var formatFunc = kbn.valueFormats[this.panel.format];\n                data.valueFormatted = formatFunc(data.value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n                data.valueRounded = kbn.roundValue(data.value, decimalInfo.decimals);\n            }\n\n            if (data == null || data.value == null) {\n                data.value = 0.0;\n            }\n\n            // Add $__name variable for using in prefix or postfix\n            data.scopedVars = _.extend({}, this.panel.scopedVars);\n            data.scopedVars[\"__name\"] = {\n                value: this.series[0].label\n            };\n        }\n    }\n\n    addSparkline() {\n        if (this.elem == null || this.elem.width() < 10) {\n            // element has not gotten it's width yet\n            // delay sparkline render\n            setTimeout(this.addSparkline, 30);\n            return;\n        }\n\n        var width = this.elem.width() + 20;\n        var height = this.ctrl.height;\n        var plotCanvas = $('<div></div>');\n        var plotCss = {};\n        plotCss.position = 'absolute';\n\n        if (this.panel.sparkline.full) {\n            plotCss.bottom = '5px';\n            plotCss.left = '-5px';\n            plotCss.width = (width - 10) + 'px';\n            var dynamicHeightMargin = height <= 100 ? 5 : (Math.round((height / 100)) * 15) + 5;\n            plotCss.height = (height - dynamicHeightMargin) + 'px';\n        } else {\n            plotCss.bottom = \"0px\";\n            plotCss.left = \"-5px\";\n            plotCss.width = (width - 10) + 'px';\n            plotCss.height = Math.floor(height * 0.25) + 'px';\n        }\n\n        plotCanvas.css(plotCss);\n\n        var options = {\n            legend: {\n                show: false\n            },\n            series: {\n                lines: {\n                    show: true,\n                    fill: 1,\n                    lineWidth: 1,\n                    fillColor: this.panel.sparkline.fillColor,\n                },\n            },\n            yaxes: {\n                show: false\n            },\n            xaxis: {\n                show: false,\n                mode: \"time\",\n                min: this.ctrl.range.from.valueOf(),\n                max: this.ctrl.range.to.valueOf(),\n            },\n            grid: {\n                hoverable: false,\n                show: false\n            },\n        };\n\n        this.elem.find('.michaeldmoore-annunciator-panel-container').append(plotCanvas);\n\n        var plotSeries = {\n            data: this.data.flotpairs,\n            color: this.panel.sparkline.lineColor\n        };\n\n        //console.log(\"annunciator::addSparkline() - \" + this.data.flotpairs.length + \" flotpairs\");\n\n        $.plot(plotCanvas, [plotSeries], options);\n    }\n\n    onConfigChanged() {\n        this.refresh();\n    }\n\n    link(scope, elem, attrs, ctrl) {\n        this.ctrl = ctrl;\n        //this.$panelContainer = elem.find('.panel-container');\n        //this.$panelsWrapper = elem.find('.panels-wrapper');\n        this.elem = elem.find('.panel-content');\n        //console.log(\"Annunciator::link()\");\n    }\n}\n\nAnnunciatorPanelCtrl.templateUrl = 'module.html';\n\nexport {\n    AnnunciatorPanelCtrl as PanelCtrl\n};"]}